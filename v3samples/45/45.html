<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <title>Birds Eye/45 Deg/Oblique(where available)</title>
    <link href="http://code.google.com/apis/maps/documentation/javascript/examples/standard.css" rel="stylesheet"
          type="text/css"/>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false">
    </script>
    <script type="text/javascript">
        function ObliqueMercatorProjection(heading) {
            this.heading_ = heading;
        }
        ObliqueMercatorProjection.prototype.fromLatLngToPoint = function(latLng) {
            var p = new google.maps.Point();
            var originX = 256 / 2;
            var originY = 256 / 2;
            var pixelsPerLngDegree = 256 / 360.0;
            var pixelsPerLngRadian = 1 * 256 / (2 * Math.PI);
            p.x = (originX + latLng.lng() * pixelsPerLngDegree);
            var f = Math.min(Math.max(Math.sin(latLng.lat() * Math.PI / 180), -0.99999), 0.9999);
            p.y = originY + 0.5 * Math.log((1 + f) / (1 - f)) * (-1) * pixelsPerLngRadian;

            var totalPixel = 256;
            var halfPixel = totalPixel / 2;
            var px = p.x, py = p.y;
            switch (this.heading_) {
                case 0: break;
                case 90: p.x = py; p.y = totalPixel - px; break;
                case 180: p.x = totalPixel - px; p.y = totalPixel - py; break;
                case 270: p.x = totalPixel - py; p.y = px; break;
            }
            p.y = (p.y - halfPixel) / Math.sqrt(2) + halfPixel;
            return p;
        }
        ObliqueMercatorProjection.prototype.fromPointToLatLng = function(pixel) {
            var totalPixel = 256;
            var halfPixel = totalPixel / 2;
            var x = pixel.x;
            var y = (pixel.y - halfPixel) * Math.sqrt(2) + halfPixel;
            var px = x;
            var py = y;
            switch (this.heading_) {
                case 0: break;
                case 90: px = totalPixel - y; py = x; break;
                case 180: px = totalPixel - x; py = totalPixel - y; break;
                case 270: px = y; py = totalPixel - x; break;
            }
            var numberOfTiles = 1;
            var originX = numberOfTiles * 256 / 2;
            var originY = numberOfTiles * 256 / 2;
            var pixelsPerLngDegree = numberOfTiles * 256 / 360.0;
            var pixelsPerLngRadian = numberOfTiles * 256 / (2 * Math.PI);
            var lng = (px - originX) / pixelsPerLngDegree;
            var g = (py - originY) / pixelsPerLngRadian * -1;
            var lat = (2 * Math.atan(Math.exp(g)) - Math.PI / 2) / (Math.PI / 180);
            return new google.maps.LatLng(lat, lng);
        }
        
        function ObliqueMercatorMapType(opts) {
            opts = opts || {};
            this.tileSize = opts.tileSize || new google.maps.Size(256, 256);
            this.heading_ = opts.heading || 0;
            this.projection = new ObliqueMercatorProjection(this.heading_);
            this.maxZoom = opts.maxZoom || 21;
            this.minZoom = opts.minZoom || 18;
            this.name = opts.name;
            this.alt = opts.alt;
        }

        ObliqueMercatorMapType.prototype.getTile = function(coord, zoom, ownerDocument) {
            var img = ownerDocument.createElement('img');
            var url = "http://khmdb0.google.com/kh?v=36&x=" + coord.x + "&y=" + coord.y + "&z=" + zoom + "&s=Gal&deg=" + this.heading_;
            img.src = url;
            img.width = this.tileSize.width;
            img.height = this.tileSize.height;
            return img;
        }

        function initialize() {
            //http://khmdb0.google.com/kh?v=36&x=45760&y=113227&z=18&s=Gal&deg=0
            var latlng = new google.maps.LatLng(32.7084, -117.1653);
            var map = new google.maps.Map(document.getElementById("map_canvas"), {
                center: latlng,
                zoom: 18,
                mapTypeId:'North',
                streetViewControl:false,
                mapTypeControlOptions: {
                    mapTypeIds: ['North','East','South','West',google.maps.MapTypeId.SATELLITE ]
                }
            });
            var nType = new ObliqueMercatorMapType({heading:0, name:'North', isPng:false});
            map.mapTypes.set('North', nType);
            var sType = new ObliqueMercatorMapType({heading:180, name:'South', isPng:false});
            map.mapTypes.set('South', sType);
            var eType = new ObliqueMercatorMapType({heading:90, name:'East', isPng:false});
            map.mapTypes.set('East', eType);
            var wType = new ObliqueMercatorMapType({heading:270, name:'West', isPng:false});
            map.mapTypes.set('West', wType);

        }

    </script>
</head>
<body onload="initialize()">
<div id="map_canvas" style="width:100%; height:100%">
</div>

</body>
</html>
