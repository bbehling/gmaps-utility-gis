<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Charlotte Oblique</title>
        <script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=ABQIAAAAGY8Xhrw1zw6Ia3dwUJVxKRTVDgad4Bvurg1SD7pTTN986X-SXRSKKVrETJW4qaW12HAV5dyl6wH7sw" type="text/javascript">
        </script>
        <style type="text/css">
            html, body {
                margin: 0px;
                height: 100%;
            }
        </style>
        <script type="text/javascript">
            var map;
            function $(id){
              return document.getElementById(id);
            }
            function showPoint(latlng) {
              $('lat').value = latlng.lat();
              $('lng').value = latlng.lng();
              var mp = map.getCurrentMapType();
              var z = map.getZoom();
              var s = mp.getTileSize();
              var prj = mp.getProjection();
              var px = prj.fromLatLngToPixel(latlng, z);
              $('msg').innerHTML = ' pixel x=' + Math.floor(px.x+0.5) + ' y=' + Math.floor(px.y+0.5) + ' z=' + z + ' tx=' + Math.floor(px.x / s) + ' ty=' + Math.floor(px.y / s) ;
            }
            function initialize() {
            
            
              if (GBrowserIsCompatible()) {
              
                map = new GMap2(document.getElementById("map_canvas"), {
                  draggableCursor: 'default'
                });
                map.setCenter(new GLatLng(35.225429, -80.838792), 19);//church 35.207364, -80.85295), 19);//center 35.227208, -80.843099
                map.setUIToDefault();
                var myCopyright = new GCopyrightCollection("© ");
                myCopyright.addCopyright(new GCopyright('Demo', new GLatLngBounds(new GLatLng(-90, -180), new GLatLng(90, 180)), 0, '©2009 COC'));
                var rmtc = new GRotatableMapTypeCollection();
                
                var deftype = new GMapType(G_SATELLITE_MAP.getTileLayers(), G_SATELLITE_MAP.getProjection(), "CharMeck", {
                  rmtc: rmtc,
                  isDefault: true
                });
                var path = 'http://maps.ci.charlotte.nc.us/mapcache/oblique';
                var ntype = new GMapType([new GTileLayer(myCopyright, 19, 19, {
                  tileUrlTemplate: path+'/n/{Z}/{Y}/{X}.jpg',
                  isPng: false,
                  opacity: 1.0
                })], new GObliqueMercator(20, 0), "CharMeckN", {
                  heading: 0,
                  rmtc: rmtc,
                  isDefault: false
                });
                var etype = new GMapType([new GTileLayer(myCopyright, 19, 19, {
                  tileUrlTemplate: path+'/w/{Z}/{Y}/{X}.jpg',
                  isPng: false,
                  opacity: 1.0
                })], new GObliqueMercator(20, 270), "CharMeckW", {
                  heading: 270,
                  rmtc: rmtc,
                  isDefault: false
                });
                var stype = new GMapType([new GTileLayer(myCopyright, 19, 19, {
                  tileUrlTemplate: path+'/s/{Z}/{Y}/{X}.jpg',
                  isPng: false,
                  opacity: 1.0
                })], new GObliqueMercator(20, 180), "CharMeckS", {
                  heading: 180,
                  rmtc: rmtc,
                  isDefault: false
                });
                var wtype = new GMapType([new GTileLayer(myCopyright, 19, 19, {
                  tileUrlTemplate: path+'/E/{Z}/{Y}/{X}.jpg',
                  isPng: false,
                  opacity: 1.0
                })], new GObliqueMercator(20, 90), "CharMeckE", {
                  heading: 90,
                  rmtc: rmtc,
                  isDefault: false
                });
                map.addMapType(deftype);
                map.setMapType(deftype);
                map.enableRotation();
                
                GEvent.addListener(map, 'click', function(ov, ll) {
                  if (ll) {
                    showPoint(ll);
                  }
                });
                showPoint(map.getCenter());
              }
            }
            
            function toggleGrid(on) {
              var imgs = map.getContainer().getElementsByTagName('img');
              for (var i = 0; i < imgs.length; i++) {
                var m = imgs[i];
                if (m.style && m.style.width == '256px') {
                  if (on) {
                    m.style.border = 'solid 1px red';
                  } else {
                    m.style.border = 'none';
                  }
                  
                }
              }
            }
            function gotoLoc() {
              var latlng = new GLatLng(parseFloat($('lat').value),parseFloat($('lng').value));
              map.setCenter(latlng);
              showPoint(latlng);
            }
        </script>
    </head>
    <body onload="initialize()" onunload="GUnload();">
        <div id="o">
            <input type="button" value="EnableRotation" onclick="map.enableRotation()"/><input type="button" value="DisableRotation" onclick="map.disableRotation()"/>
       
        <input type="checkbox" onclick="toggleGrid(this.checked)">Show Grid
       
               <span> Lat:<input type="text" id="lat" value=""/>
            </span>
            <span>
                Lng:<input type="text" id="lng" value=""/>
            </span>
             <input type="button" value="GoLatLng" onclick="gotoLoc()">
            </div>
        <div id="msg"> </div>
        <div id="map_canvas" style="width: 100%; height: 800px">
        </div>
    </body>
</html>
