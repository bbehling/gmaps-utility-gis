(function(){var f=function(a){var b;switch(a){case'thin':b="2px";break;case'medium':b="4px";break;case'thick':b="6px";break;default:b=a}return b};var i=function(h){var b;var a={};if(document.defaultView&&document.defaultView.getComputedStyle){b=h.ownerDocument.defaultView.getComputedStyle(h,"");if(b){a.top=parseInt(b.borderTopWidth,10)||0;a.bottom=parseInt(b.borderBottomWidth,10)||0;a.left=parseInt(b.borderLeftWidth,10)||0;a.right=parseInt(b.borderRightWidth,10)||0;return a}}else if(document.documentElement.currentStyle){if(h.currentStyle){a.top=parseInt(f(h.currentStyle.borderTopWidth),10)||0;a.bottom=parseInt(f(h.currentStyle.borderBottomWidth),10)||0;a.left=parseInt(f(h.currentStyle.borderLeftWidth),10)||0;a.right=parseInt(f(h.currentStyle.borderRightWidth),10)||0;return a}}a.top=parseInt(h.style["border-top-width"],10)||0;a.bottom=parseInt(h.style["border-bottom-width"],10)||0;a.left=parseInt(h.style["border-left-width"],10)||0;a.right=parseInt(h.style["border-right-width"],10)||0;return a};var g=function(e){var a=0,posY=0;e=e||window.event;if(typeof e.pageX!=="undefined"){a=e.pageX;posY=e.pageY}else if(typeof e.clientX!=="undefined"){a=e.clientX+(typeof document.documentElement.scrollLeft!=="undefined"?document.documentElement.scrollLeft:document.body.scrollLeft);posY=e.clientY+(typeof document.documentElement.scrollTop!=="undefined"?document.documentElement.scrollTop:document.body.scrollTop)}return{left:a,top:posY}};var l=function(h){var a=h.offsetLeft;var b=h.offsetTop;var c=h.offsetParent;while(c!==null){if(c!==document.body&&c!==document.documentElement){a-=c.scrollLeft;b-=c.scrollTop}a+=c.offsetLeft;b+=c.offsetTop;c=c.offsetParent}return{left:a,top:b}};var j=function(a,b){if(a&&b){for(var x in b){if(b.hasOwnProperty(x)){a[x]=b[x]}}}return a};var k=function(a,b){if(typeof b!=='undefined'){a.style.opacity=b}if(typeof a.style.opacity!=='undefined'){a.style.filter="alpha(opacity="+(a.style.opacity*100)+")"}};function DragZoom(b,a){this.map_=b;a=a||{};this.key_=a.key||'shift';this.key_=this.key_.toLowerCase();this.borderWidths_=i(this.map_.getContainer());this.paneDiv_=document.createElement("div");this.paneDiv_.onselectstart=function(){return false};j(this.paneDiv_.style,{backgroundColor:'white',opacity:0.0,cursor:'crosshair'});j(this.paneDiv_.style,a.paneStyle);j(this.paneDiv_.style,{position:'absolute',overflow:'hidden',zIndex:101,display:'none'});if(this.key_==='shift'){this.paneDiv_.style.MozUserSelect="none"}k(this.paneDiv_);if(this.paneDiv_.style.backgroundColor==='transparent'){this.paneDiv_.style.backgroundColor='white';k(this.paneDiv_,0)}this.map_.getContainer().appendChild(this.paneDiv_);this.boxDiv_=document.createElement('div');j(this.boxDiv_.style,{border:'thin solid #FF0000'});j(this.boxDiv_.style,a.boxStyle);j(this.boxDiv_.style,{position:'absolute',display:'none'});k(this.boxDiv_);this.map_.getContainer().appendChild(this.boxDiv_);this.boxBorderWidths_=i(this.boxDiv_);this.keyDownListener_=GEvent.bindDom(document,'keydown',this,this.onKeyDown_);this.keyUpListener_=GEvent.bindDom(document,'keyup',this,this.onKeyUp_);this.mouseDownListener_=GEvent.bindDom(this.paneDiv_,'mousedown',this,this.onMouseDown_);this.mouseMoveListener_=GEvent.bindDom(document,'mousemove',this,this.onMouseMove_);this.mouseUpListener_=GEvent.bindDom(document,'mouseup',this,this.onMouseUp_);this.hotKeyDown_=false;this.dragging_=false;this.startLatLng_=null;this.endLatLng_=null;this.mapPosn_=null;this.boxMaxX_=null;this.boxMaxY_=null}DragZoom.prototype.drawBox_=function(){if(this.map_&&this.startLatLng_&&this.endLatLng_){var b=this.map_.fromLatLngToContainerPixel(this.startLatLng_);var a=this.map_.fromLatLngToContainerPixel(this.endLatLng_);this.boxDiv_.style.left=Math.min(b.x,a.x)+'px';this.boxDiv_.style.top=Math.min(b.y,a.y)+'px';this.boxDiv_.style.width=Math.abs(b.x-a.x)+'px';this.boxDiv_.style.height=Math.abs(b.y-a.y)+'px';this.boxDiv_.style.display='block'}};DragZoom.prototype.zoomBox_=function(){if(this.map_&&this.startLatLng_&&this.endLatLng_){var d=new GLatLng(Math.min(this.startLatLng_.lat(),this.endLatLng_.lat()),Math.min(this.startLatLng_.lng(),this.endLatLng_.lng()));var c=new GLatLng(Math.max(this.startLatLng_.lat(),this.endLatLng_.lat()),Math.max(this.startLatLng_.lng(),this.endLatLng_.lng()));var a=new GLatLngBounds(d,c);var b=this.map_.getBoundsZoomLevel(a);this.map_.setCenter(a.getCenter(),b)}};DragZoom.prototype.isHotKeyDown_=function(e){var a;e=e||window.event;a=(e.shiftKey&&this.key_==='shift')||(e.altKey&&this.key_==='alt')||(e.ctrlKey&&this.key_==='ctrl');if(!a){switch(e.keyCode){case 16:if(this.key_==='shift'){a=true}break;case 17:if(this.key_==='ctrl'){a=true}break;case 18:if(this.key_==='alt'){a=true}break}}return a};DragZoom.prototype.onKeyDown_=function(e){if(this.map_&&!this.hotKeyDown_&&this.isHotKeyDown_(e)){this.hotKeyDown_=true;var a=this.map_.getSize();this.paneDiv_.style.left=0+'px';this.paneDiv_.style.top=0+'px';this.paneDiv_.style.width=a.width-(this.borderWidths_.left+this.borderWidths_.right)+'px';this.paneDiv_.style.height=a.height-(this.borderWidths_.top+this.borderWidths_.bottom)+'px';this.paneDiv_.style.display='block';this.boxMaxX_=parseInt(this.paneDiv_.style.width,10)-(this.boxBorderWidths_.left+this.boxBorderWidths_.right);this.boxMaxY_=parseInt(this.paneDiv_.style.height,10)-(this.boxBorderWidths_.top+this.boxBorderWidths_.bottom);GEvent.trigger(this,'activate')}};DragZoom.prototype.onMouseDown_=function(e){if(this.map_&&this.hotKeyDown_){this.startLatLng_=this.endLatLng_=null;this.mapPosn_=l(this.map_.getContainer());this.dragging_=true;GEvent.trigger(this,'dragstart')}};DragZoom.prototype.onMouseMove_=function(e){if(this.dragging_){var b=g(e);var p=new GPoint();p.x=b.left-this.mapPosn_.left-this.borderWidths_.left;p.y=b.top-this.mapPosn_.top-this.borderWidths_.top;p.x=Math.min(p.x,this.boxMaxX_);p.y=Math.min(p.y,this.boxMaxY_);p.x=Math.max(p.x,0);p.y=Math.max(p.y,0);var a=this.map_.fromContainerPixelToLatLng(p);if(!this.startLatLng_){this.startLatLng_=a}this.endLatLng_=a;this.drawBox_();GEvent.trigger(this,'drag')}};DragZoom.prototype.onMouseUp_=function(e){if(this.dragging_){this.zoomBox_();this.dragging_=false}this.boxDiv_.style.display='none';GEvent.trigger(this,'dragend')};DragZoom.prototype.onKeyUp_=function(e){if(this.map_&&this.hotKeyDown_){this.hotKeyDown_=false;this.dragging_=false;this.boxDiv_.style.display='none';this.paneDiv_.style.display="none";GEvent.trigger(this,'deactivate')}};GMap2.prototype.enableKeyDragZoom=function(a){this.dragZoom_=new DragZoom(this,a)};GMap2.prototype.disableKeyDragZoom=function(){var d=this.dragZoom_;if(d){GEvent.removeListener(d.mouseDownListener_);GEvent.removeListener(d.mouseMoveListener_);GEvent.removeListener(d.mouseUpListener_);GEvent.removeListener(d.keyUpListener_);GEvent.removeListener(d.keyDownListener_);this.getContainer().removeChild(d.boxDiv_);this.getContainer().removeChild(d.paneDiv_);this.dragZoom_=null}};GMap2.prototype.keyDragZoomEnabled=function(){return this.dragZoom_!==null};GMap2.prototype.getDragZoomObject=function(){return this.dragZoom_}})();